<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Counting Semaphores</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 92px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ChibiOS/RT<br><span id="projectnumber">2.6.7</span></div>
  </td>
  <td style="padding-left: 3em;">
<script type="text/javascript"><!--
google_ad_client = "pub-3840594581853944";
/* Documentation, bottom, 728x90, created 9/19/10 */
google_ad_slot = "1902290615";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__semaphores.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a>  </div>
  <div class="headertitle">
<div class="title">Counting Semaphores<div class="ingroups"><a class="el" href="group__kernel.html">Kernel</a> &raquo; <a class="el" href="group__synchronization.html">Synchronization</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Counting Semaphores:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__semaphores.png" border="0" alt="" usemap="#group____semaphores"/>
<map name="group____semaphores" id="group____semaphores">
<area shape="rect" id="node1" href="group__synchronization.html" title="Synchronization" alt="" coords="5,5,116,29"/></map>
</td></tr></table></center>
</div>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Semaphores related APIs and services. </p><pre class="fragment">     &lt;h2&gt;Operation mode&lt;/h2&gt;
     Semaphores are a flexible synchronization primitive, ChibiOS/RT
     implements semaphores in their "counting semaphores" variant as
     defined by Edsger Dijkstra plus several enhancements like:
     - Wait operation with timeout.
     - Reset operation.
     - Atomic wait+signal operation.
     - Return message from the wait operation (OK, RESET, TIMEOUT).
     .
     The binary semaphores variant can be easily implemented using
     counting semaphores.&lt;br&gt;
     Operations defined for semaphores:
     - &lt;b&gt;Signal&lt;/b&gt;: The semaphore counter is increased and if the
       result is non-positive then a waiting thread is removed from
       the semaphore queue and made ready for execution.
     - &lt;b&gt;Wait&lt;/b&gt;: The semaphore counter is decreased and if the result
       becomes negative the thread is queued in the semaphore and
       suspended.
     - &lt;b&gt;Reset&lt;/b&gt;: The semaphore counter is reset to a non-negative
       value and all the threads in the queue are released.
     .
     Semaphores can be used as guards for mutual exclusion zones
     (note that mutexes are recommended for this kind of use) but
     also have other uses, queues guards and counters for example.&lt;br&gt;
     Semaphores usually use a FIFO queuing strategy but it is possible
     to make them order threads by priority by enabling
     @p CH_USE_SEMAPHORES_PRIORITY in @p chconf.h.
</pre> <dl class="section pre"><dt>Precondition</dt><dd>In order to use the semaphore APIs the <code>CH_USE_SEMAPHORES</code> option must be enabled in <code><a class="el" href="chconf_8h.html" title="Configuration file template. ">chconf.h</a></code>. </dd></dl>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_semaphore.html">Semaphore</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a> structure.  <a href="struct_semaphore.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafe8fc6155a871074e8017efd908b2c58"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gafe8fc6155a871074e8017efd908b2c58">chSemInit</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp, <a class="el" href="group__types.html#ga090b3bab5602157ebf706a44041dc05e">cnt_t</a> n)</td></tr>
<tr class="memdesc:gafe8fc6155a871074e8017efd908b2c58"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a semaphore with the specified counter value.  <a href="#gafe8fc6155a871074e8017efd908b2c58">More...</a><br /></td></tr>
<tr class="separator:gafe8fc6155a871074e8017efd908b2c58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga58e266e609cfd3dbc67f299b3ae9debb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#ga58e266e609cfd3dbc67f299b3ae9debb">chSemReset</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp, <a class="el" href="group__types.html#ga090b3bab5602157ebf706a44041dc05e">cnt_t</a> n)</td></tr>
<tr class="memdesc:ga58e266e609cfd3dbc67f299b3ae9debb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a reset operation on the semaphore.  <a href="#ga58e266e609cfd3dbc67f299b3ae9debb">More...</a><br /></td></tr>
<tr class="separator:ga58e266e609cfd3dbc67f299b3ae9debb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae7972b6b22b80ac09bac5a186277ab81"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gae7972b6b22b80ac09bac5a186277ab81">chSemResetI</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp, <a class="el" href="group__types.html#ga090b3bab5602157ebf706a44041dc05e">cnt_t</a> n)</td></tr>
<tr class="memdesc:gae7972b6b22b80ac09bac5a186277ab81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a reset operation on the semaphore.  <a href="#gae7972b6b22b80ac09bac5a186277ab81">More...</a><br /></td></tr>
<tr class="separator:gae7972b6b22b80ac09bac5a186277ab81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabc8f7e509870e9b0527a6a68fad71425"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gabc8f7e509870e9b0527a6a68fad71425">chSemWait</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp)</td></tr>
<tr class="memdesc:gabc8f7e509870e9b0527a6a68fad71425"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a wait operation on a semaphore.  <a href="#gabc8f7e509870e9b0527a6a68fad71425">More...</a><br /></td></tr>
<tr class="separator:gabc8f7e509870e9b0527a6a68fad71425"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa2c0367078533e291d2e889e251d8b67"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gaa2c0367078533e291d2e889e251d8b67">chSemWaitS</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp)</td></tr>
<tr class="memdesc:gaa2c0367078533e291d2e889e251d8b67"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a wait operation on a semaphore.  <a href="#gaa2c0367078533e291d2e889e251d8b67">More...</a><br /></td></tr>
<tr class="separator:gaa2c0367078533e291d2e889e251d8b67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0bc227311e5be3e3b6e3aee6a68169da"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#ga0bc227311e5be3e3b6e3aee6a68169da">chSemWaitTimeout</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp, <a class="el" href="group__types.html#gae3e32a98d431a02106616da3071832dd">systime_t</a> time)</td></tr>
<tr class="memdesc:ga0bc227311e5be3e3b6e3aee6a68169da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a wait operation on a semaphore with timeout specification.  <a href="#ga0bc227311e5be3e3b6e3aee6a68169da">More...</a><br /></td></tr>
<tr class="separator:ga0bc227311e5be3e3b6e3aee6a68169da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga924ec5d191bb8debe8727ae4dd5d6d03"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#ga924ec5d191bb8debe8727ae4dd5d6d03">chSemWaitTimeoutS</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp, <a class="el" href="group__types.html#gae3e32a98d431a02106616da3071832dd">systime_t</a> time)</td></tr>
<tr class="memdesc:ga924ec5d191bb8debe8727ae4dd5d6d03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a wait operation on a semaphore with timeout specification.  <a href="#ga924ec5d191bb8debe8727ae4dd5d6d03">More...</a><br /></td></tr>
<tr class="separator:ga924ec5d191bb8debe8727ae4dd5d6d03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7ec0cbda23e49e2370e0b91f20baf05e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#ga7ec0cbda23e49e2370e0b91f20baf05e">chSemSignal</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp)</td></tr>
<tr class="memdesc:ga7ec0cbda23e49e2370e0b91f20baf05e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a signal operation on a semaphore.  <a href="#ga7ec0cbda23e49e2370e0b91f20baf05e">More...</a><br /></td></tr>
<tr class="separator:ga7ec0cbda23e49e2370e0b91f20baf05e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaca0b70cf495a9cb7569e1cf5b07e2b3d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gaca0b70cf495a9cb7569e1cf5b07e2b3d">chSemSignalI</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp)</td></tr>
<tr class="memdesc:gaca0b70cf495a9cb7569e1cf5b07e2b3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a signal operation on a semaphore.  <a href="#gaca0b70cf495a9cb7569e1cf5b07e2b3d">More...</a><br /></td></tr>
<tr class="separator:gaca0b70cf495a9cb7569e1cf5b07e2b3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae4e4d20901d3ac1ad24f68373ac10b0e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gae4e4d20901d3ac1ad24f68373ac10b0e">chSemAddCounterI</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sp, <a class="el" href="group__types.html#ga090b3bab5602157ebf706a44041dc05e">cnt_t</a> n)</td></tr>
<tr class="memdesc:gae4e4d20901d3ac1ad24f68373ac10b0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds the specified value to the semaphore counter.  <a href="#gae4e4d20901d3ac1ad24f68373ac10b0e">More...</a><br /></td></tr>
<tr class="separator:gae4e4d20901d3ac1ad24f68373ac10b0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0dc7b4339506de346d67b4560b271e44"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#ga0dc7b4339506de346d67b4560b271e44">chSemSignalWait</a> (<a class="el" href="struct_semaphore.html">Semaphore</a> *sps, <a class="el" href="struct_semaphore.html">Semaphore</a> *spw)</td></tr>
<tr class="memdesc:ga0dc7b4339506de346d67b4560b271e44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs atomic signal and wait operations on two semaphores.  <a href="#ga0dc7b4339506de346d67b4560b271e44">More...</a><br /></td></tr>
<tr class="separator:ga0dc7b4339506de346d67b4560b271e44"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Macro Functions</h2></td></tr>
<tr class="memitem:ga748b56bc2be187e316496d7b6e748f89"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#ga748b56bc2be187e316496d7b6e748f89">chSemFastWaitI</a>(sp)&#160;&#160;&#160;((sp)-&gt;s_cnt--)</td></tr>
<tr class="memdesc:ga748b56bc2be187e316496d7b6e748f89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decreases the semaphore counter.  <a href="#ga748b56bc2be187e316496d7b6e748f89">More...</a><br /></td></tr>
<tr class="separator:ga748b56bc2be187e316496d7b6e748f89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacb89a28bd1fff2704207423f350215ba"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gacb89a28bd1fff2704207423f350215ba">chSemFastSignalI</a>(sp)&#160;&#160;&#160;((sp)-&gt;s_cnt++)</td></tr>
<tr class="memdesc:gacb89a28bd1fff2704207423f350215ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Increases the semaphore counter.  <a href="#gacb89a28bd1fff2704207423f350215ba">More...</a><br /></td></tr>
<tr class="separator:gacb89a28bd1fff2704207423f350215ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadab3ccf8a34988ef6d410354b2648327"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gadab3ccf8a34988ef6d410354b2648327">chSemGetCounterI</a>(sp)&#160;&#160;&#160;((sp)-&gt;s_cnt)</td></tr>
<tr class="memdesc:gadab3ccf8a34988ef6d410354b2648327"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the semaphore counter current value.  <a href="#gadab3ccf8a34988ef6d410354b2648327">More...</a><br /></td></tr>
<tr class="separator:gadab3ccf8a34988ef6d410354b2648327"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga1100c867cc8bd8328f7a7db5e7c74f6d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#ga1100c867cc8bd8328f7a7db5e7c74f6d">_SEMAPHORE_DATA</a>(name,  n)&#160;&#160;&#160;{<a class="el" href="group__internals.html#ga9ac5ac4cb62a9baa48d2004876852112">_THREADSQUEUE_DATA</a>(name.s_queue), n}</td></tr>
<tr class="memdesc:ga1100c867cc8bd8328f7a7db5e7c74f6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data part of a static semaphore initializer.  <a href="#ga1100c867cc8bd8328f7a7db5e7c74f6d">More...</a><br /></td></tr>
<tr class="separator:ga1100c867cc8bd8328f7a7db5e7c74f6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac09ac6a24cd3dbe91ac13d72bebf67c1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gac09ac6a24cd3dbe91ac13d72bebf67c1">SEMAPHORE_DECL</a>(name,  n)&#160;&#160;&#160;<a class="el" href="struct_semaphore.html">Semaphore</a> name = <a class="el" href="group__semaphores.html#ga1100c867cc8bd8328f7a7db5e7c74f6d">_SEMAPHORE_DATA</a>(name, n)</td></tr>
<tr class="memdesc:gac09ac6a24cd3dbe91ac13d72bebf67c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Static semaphore initializer.  <a href="#gac09ac6a24cd3dbe91ac13d72bebf67c1">More...</a><br /></td></tr>
<tr class="separator:gac09ac6a24cd3dbe91ac13d72bebf67c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gac28c458b44903a8093398ef50333c513"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct_semaphore.html">Semaphore</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphores.html#gac28c458b44903a8093398ef50333c513">Semaphore</a></td></tr>
<tr class="memdesc:gac28c458b44903a8093398ef50333c513"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a> structure.  <a href="#gac28c458b44903a8093398ef50333c513">More...</a><br /></td></tr>
<tr class="separator:gac28c458b44903a8093398ef50333c513"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gafe8fc6155a871074e8017efd908b2c58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chSemInit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__types.html#ga090b3bab5602157ebf706a44041dc05e">cnt_t</a>&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a semaphore with the specified counter value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>initial value of the semaphore counter. Must be non-negative.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Initializer, this function just initializes an object and can be invoked before the kernel is initialized. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00086">86</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__internals.html#ga6d19d0f3ff1fa599b6d9783dec180451">queue_init</a>, <a class="el" href="struct_semaphore.html#ae42955cd2346167681e0fd6a136369cd">Semaphore::s_cnt</a>, and <a class="el" href="struct_semaphore.html#a26051a38c22dc11a7a2bf37496d8e906">Semaphore::s_queue</a>.</p>

<p>Referenced by <a class="el" href="group__heaps.html#ga777708769d35996ed5f0d8bd4642217c">_heap_init()</a>, <a class="el" href="group___a_d_c.html#gac7f619e304c79c17f19221d05138d405">adcObjectInit()</a>, <a class="el" href="group___c_a_n.html#gadf8c892ca4bd2544d03be8a690885aef">canObjectInit()</a>, <a class="el" href="group__heaps.html#ga7135c9ddbd1402a4a36ce44df948f4e4">chHeapInit()</a>, <a class="el" href="group__mailboxes.html#gaff65b97bfdbf9144e9727a100a9be93a">chMBInit()</a>, <a class="el" href="group___i2_c.html#ga2dd7be686d8e136b1deebfeb20e868f9">i2cObjectInit()</a>, <a class="el" href="group___m_a_c.html#ga34d60b00ad9794d52da6833e18c9ec70">macObjectInit()</a>, and <a class="el" href="group___s_p_i.html#ga87a7bdc554b8e8fdfc77064e67689fcf">spiObjectInit()</a>.</p>

</div>
</div>
<a class="anchor" id="ga58e266e609cfd3dbc67f299b3ae9debb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chSemReset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__types.html#ga090b3bab5602157ebf706a44041dc05e">cnt_t</a>&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a reset operation on the semaphore. </p>
<dl class="section post"><dt>Postcondition</dt><dd>After invoking this function all the threads waiting on the semaphore, if any, are released and the semaphore counter is set to the specified, non negative, value. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The released threads can recognize they were waked up by a reset rather than a signal because the <code><a class="el" href="group__semaphores.html#gabc8f7e509870e9b0527a6a68fad71425" title="Performs a wait operation on a semaphore. ">chSemWait()</a></code> will return <code>RDY_RESET</code> instead of <code>RDY_OK</code>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>the new value of the semaphore counter. The value must be non-negative.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00109">109</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__scheduler.html#ga4e38b4bee3d2330f6a0f1cdb7660af20">chSchRescheduleS()</a>, <a class="el" href="group__semaphores.html#gae7972b6b22b80ac09bac5a186277ab81">chSemResetI()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, and <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_ga58e266e609cfd3dbc67f299b3ae9debb_cgraph.png" border="0" usemap="#group__semaphores_ga58e266e609cfd3dbc67f299b3ae9debb_cgraph" alt=""/></div>
<map name="group__semaphores_ga58e266e609cfd3dbc67f299b3ae9debb_cgraph" id="group__semaphores_ga58e266e609cfd3dbc67f299b3ae9debb_cgraph">
<area shape="rect" id="node2" href="group__scheduler.html#ga4e38b4bee3d2330f6a0f1cdb7660af20" title="Performs a reschedule if a higher priority thread is runnable. " alt="" coords="147,53,276,77"/><area shape="rect" id="node7" href="group__semaphores.html#gae7972b6b22b80ac09bac5a186277ab81" title="Performs a reset operation on the semaphore. " alt="" coords="163,128,259,152"/><area shape="rect" id="node3" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="543,5,673,29"/><area shape="rect" id="node5" href="group__scheduler.html#ga6827a67e839462e65b5765ef15709c97" title="Switches to the first thread on the runnable queue. " alt="" coords="324,53,495,77"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="721,55,808,79"/><area shape="rect" id="node6" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="563,53,653,77"/><area shape="rect" id="node8" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="545,103,671,127"/><area shape="rect" id="node9" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="363,152,456,176"/><area shape="rect" id="node10" href="group__internals.html#gacacfe77140cab62948e63d898bf4dfba" title="Removes the last&#45;out Thread from a queue and returns it. " alt="" coords="365,200,453,224"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gae7972b6b22b80ac09bac5a186277ab81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chSemResetI </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__types.html#ga090b3bab5602157ebf706a44041dc05e">cnt_t</a>&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a reset operation on the semaphore. </p>
<dl class="section post"><dt>Postcondition</dt><dd>After invoking this function all the threads waiting on the semaphore, if any, are released and the semaphore counter is set to the specified, non negative, value. </dd>
<dd>
This function does not reschedule so a call to a rescheduling function must be performed before unlocking the kernel. Note that interrupt handlers always reschedule on exit so an explicit reschedule must not be performed in ISRs. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The released threads can recognize they were waked up by a reset rather than a signal because the <code><a class="el" href="group__semaphores.html#gabc8f7e509870e9b0527a6a68fad71425" title="Performs a wait operation on a semaphore. ">chSemWait()</a></code> will return <code>RDY_RESET</code> instead of <code>RDY_OK</code>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>the new value of the semaphore counter. The value must be non-negative.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>I-Class</b> API, this function can be invoked from within a system lock zone by both threads and interrupt handlers. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00136">136</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470">chDbgCheckClassI()</a>, <a class="el" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298">chSchReadyI()</a>, <a class="el" href="group__internals.html#gadf402c10356566d82a6631c102b7f656">isempty</a>, <a class="el" href="group__internals.html#gacacfe77140cab62948e63d898bf4dfba">lifo_remove()</a>, <a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>, <a class="el" href="struct_thread.html#a72cd0424b6098ca241fac1f74d21b56a">Thread::p_u</a>, <a class="el" href="group__scheduler.html#ga3a606c833796229f23adcb3f6c404a81">RDY_RESET</a>, <a class="el" href="struct_thread.html#ad5792c30fbd60df0de223b0f398fc6d7">Thread::rdymsg</a>, <a class="el" href="struct_semaphore.html#ae42955cd2346167681e0fd6a136369cd">Semaphore::s_cnt</a>, and <a class="el" href="struct_semaphore.html#a26051a38c22dc11a7a2bf37496d8e906">Semaphore::s_queue</a>.</p>

<p>Referenced by <a class="el" href="group___c_a_n.html#ga4e89a7d246119e077d27431a02586133">canStop()</a>, <a class="el" href="group__mailboxes.html#ga4199e224456395c3dbc74dbc889dff94">chMBReset()</a>, and <a class="el" href="group__semaphores.html#ga58e266e609cfd3dbc67f299b3ae9debb">chSemReset()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_gae7972b6b22b80ac09bac5a186277ab81_cgraph.png" border="0" usemap="#group__semaphores_gae7972b6b22b80ac09bac5a186277ab81_cgraph" alt=""/></div>
<map name="group__semaphores_gae7972b6b22b80ac09bac5a186277ab81_cgraph" id="group__semaphores_gae7972b6b22b80ac09bac5a186277ab81_cgraph">
<area shape="rect" id="node2" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="291,5,417,29"/><area shape="rect" id="node4" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="149,29,243,53"/><area shape="rect" id="node5" href="group__internals.html#gacacfe77140cab62948e63d898bf4dfba" title="Removes the last&#45;out Thread from a queue and returns it. " alt="" coords="152,77,240,101"/><area shape="rect" id="node3" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="465,5,552,29"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gabc8f7e509870e9b0527a6a68fad71425"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a> chSemWait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a wait operation on a semaphore. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A message specifying how the invoking thread has been released from the semaphore. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RDY_OK</td><td>if the thread has not stopped on the semaphore or the semaphore has been signaled. </td></tr>
    <tr><td class="paramname">RDY_RESET</td><td>if the semaphore has been reset using <code><a class="el" href="group__semaphores.html#ga58e266e609cfd3dbc67f299b3ae9debb" title="Performs a reset operation on the semaphore. ">chSemReset()</a></code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00164">164</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__semaphores.html#gaa2c0367078533e291d2e889e251d8b67">chSemWaitS()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, and <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>.</p>

<p>Referenced by <a class="el" href="group___a_d_c.html#ga61ae6a7495100110e7b6fd46a6693a02">adcAcquireBus()</a>, <a class="el" href="group___i2_c.html#gace46540c237d310d9ea09f1adfcdb6d5">i2cAcquireBus()</a>, and <a class="el" href="group___s_p_i.html#ga803cec73f6dd8d3d1f18fb6a61b8255a">spiAcquireBus()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_gabc8f7e509870e9b0527a6a68fad71425_cgraph.png" border="0" usemap="#group__semaphores_gabc8f7e509870e9b0527a6a68fad71425_cgraph" alt=""/></div>
<map name="group__semaphores_gabc8f7e509870e9b0527a6a68fad71425_cgraph" id="group__semaphores_gabc8f7e509870e9b0527a6a68fad71425_cgraph">
<area shape="rect" id="node2" href="group__semaphores.html#gaa2c0367078533e291d2e889e251d8b67" title="Performs a wait operation on a semaphore. " alt="" coords="136,29,227,53"/><area shape="rect" id="node3" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="435,5,565,29"/><area shape="rect" id="node5" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986" title="Puts the current thread to sleep into the specified state. " alt="" coords="275,53,387,77"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="613,5,700,29"/><area shape="rect" id="node6" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="455,53,545,77"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaa2c0367078533e291d2e889e251d8b67"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a> chSemWaitS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a wait operation on a semaphore. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A message specifying how the invoking thread has been released from the semaphore. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RDY_OK</td><td>if the thread has not stopped on the semaphore or the semaphore has been signaled. </td></tr>
    <tr><td class="paramname">RDY_RESET</td><td>if the semaphore has been reset using <code><a class="el" href="group__semaphores.html#ga58e266e609cfd3dbc67f299b3ae9debb" title="Performs a reset operation on the semaphore. ">chSemReset()</a></code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>S-Class</b> API, this function can be invoked from within a system lock zone by threads only. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00185">185</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167">chDbgCheckClassS()</a>, <a class="el" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986">chSchGoSleepS()</a>, <a class="el" href="group__scheduler.html#ga1a5fddde56420e8accd0c09c1abb32a7">currp</a>, <a class="el" href="group__internals.html#gadf402c10356566d82a6631c102b7f656">isempty</a>, <a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>, <a class="el" href="group__scheduler.html#gae1c86078318e11c2fa57ee3c2ec69f61">RDY_OK</a>, <a class="el" href="struct_semaphore.html#ae42955cd2346167681e0fd6a136369cd">Semaphore::s_cnt</a>, <a class="el" href="struct_semaphore.html#a26051a38c22dc11a7a2bf37496d8e906">Semaphore::s_queue</a>, and <a class="el" href="group__threads.html#gad0b81cae859c0a6bc6a0d2036aa8e272">THD_STATE_WTSEM</a>.</p>

<p>Referenced by <a class="el" href="group__semaphores.html#gabc8f7e509870e9b0527a6a68fad71425">chSemWait()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_gaa2c0367078533e291d2e889e251d8b67_cgraph.png" border="0" usemap="#group__semaphores_gaa2c0367078533e291d2e889e251d8b67_cgraph" alt=""/></div>
<map name="group__semaphores_gaa2c0367078533e291d2e889e251d8b67_cgraph" id="group__semaphores_gaa2c0367078533e291d2e889e251d8b67_cgraph">
<area shape="rect" id="node2" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="304,5,435,29"/><area shape="rect" id="node4" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986" title="Puts the current thread to sleep into the specified state. " alt="" coords="144,53,256,77"/><area shape="rect" id="node3" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="483,5,569,29"/><area shape="rect" id="node5" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="325,53,414,77"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga0bc227311e5be3e3b6e3aee6a68169da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a> chSemWaitTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__types.html#gae3e32a98d431a02106616da3071832dd">systime_t</a>&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a wait operation on a semaphore with timeout specification. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>the number of ticks before the operation timeouts, the following special values are allowed:<ul>
<li><em>TIME_IMMEDIATE</em> immediate timeout.</li>
<li><em>TIME_INFINITE</em> no timeout.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A message specifying how the invoking thread has been released from the semaphore. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RDY_OK</td><td>if the thread has not stopped on the semaphore or the semaphore has been signaled. </td></tr>
    <tr><td class="paramname">RDY_RESET</td><td>if the semaphore has been reset using <code><a class="el" href="group__semaphores.html#ga58e266e609cfd3dbc67f299b3ae9debb" title="Performs a reset operation on the semaphore. ">chSemReset()</a></code>. </td></tr>
    <tr><td class="paramname">RDY_TIMEOUT</td><td>if the semaphore has not been signaled or reset within the specified timeout.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00222">222</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__semaphores.html#ga924ec5d191bb8debe8727ae4dd5d6d03">chSemWaitTimeoutS()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, and <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_ga0bc227311e5be3e3b6e3aee6a68169da_cgraph.png" border="0" usemap="#group__semaphores_ga0bc227311e5be3e3b6e3aee6a68169da_cgraph" alt=""/></div>
<map name="group__semaphores_ga0bc227311e5be3e3b6e3aee6a68169da_cgraph" id="group__semaphores_ga0bc227311e5be3e3b6e3aee6a68169da_cgraph">
<area shape="rect" id="node2" href="group__semaphores.html#ga924ec5d191bb8debe8727ae4dd5d6d03" title="Performs a wait operation on a semaphore with timeout specification. " alt="" coords="183,5,320,29"/><area shape="rect" id="node3" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="735,5,865,29"/><area shape="rect" id="node5" href="group__scheduler.html#ga306e564f678c1a39139639490c77e78b" title="Puts the current thread to sleep into the specified state with timeout specification. " alt="" coords="368,55,527,79"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="913,5,1000,29"/><area shape="rect" id="node6" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986" title="Puts the current thread to sleep into the specified state. " alt="" coords="575,55,687,79"/><area shape="rect" id="node7" href="group__time.html#ga680d851a74e594cc965101e79891840f" title="Disables a Virtual Timer. " alt="" coords="589,103,673,127"/><area shape="rect" id="node8" href="group__time.html#ga1c44c3a0bc64b2954d95cd98b2e7124e" title="Enables a virtual timer. " alt="" coords="595,151,666,175"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga924ec5d191bb8debe8727ae4dd5d6d03"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a> chSemWaitTimeoutS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__types.html#gae3e32a98d431a02106616da3071832dd">systime_t</a>&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a wait operation on a semaphore with timeout specification. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>the number of ticks before the operation timeouts, the following special values are allowed:<ul>
<li><em>TIME_IMMEDIATE</em> immediate timeout.</li>
<li><em>TIME_INFINITE</em> no timeout.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A message specifying how the invoking thread has been released from the semaphore. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RDY_OK</td><td>if the thread has not stopped on the semaphore or the semaphore has been signaled. </td></tr>
    <tr><td class="paramname">RDY_RESET</td><td>if the semaphore has been reset using <code><a class="el" href="group__semaphores.html#ga58e266e609cfd3dbc67f299b3ae9debb" title="Performs a reset operation on the semaphore. ">chSemReset()</a></code>. </td></tr>
    <tr><td class="paramname">RDY_TIMEOUT</td><td>if the semaphore has not been signaled or reset within the specified timeout.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>S-Class</b> API, this function can be invoked from within a system lock zone by threads only. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00250">250</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167">chDbgCheckClassS()</a>, <a class="el" href="group__scheduler.html#ga306e564f678c1a39139639490c77e78b">chSchGoSleepTimeoutS()</a>, <a class="el" href="group__scheduler.html#ga1a5fddde56420e8accd0c09c1abb32a7">currp</a>, <a class="el" href="group__internals.html#gadf402c10356566d82a6631c102b7f656">isempty</a>, <a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>, <a class="el" href="group__scheduler.html#gae1c86078318e11c2fa57ee3c2ec69f61">RDY_OK</a>, <a class="el" href="group__scheduler.html#gaf28d5427eeeb8f737cc7db495157780c">RDY_TIMEOUT</a>, <a class="el" href="struct_semaphore.html#ae42955cd2346167681e0fd6a136369cd">Semaphore::s_cnt</a>, <a class="el" href="struct_semaphore.html#a26051a38c22dc11a7a2bf37496d8e906">Semaphore::s_queue</a>, <a class="el" href="group__threads.html#gad0b81cae859c0a6bc6a0d2036aa8e272">THD_STATE_WTSEM</a>, and <a class="el" href="group__scheduler.html#gad1ac15e9e5fc17810a94a779257f3d29">TIME_IMMEDIATE</a>.</p>

<p>Referenced by <a class="el" href="group___c_a_n.html#gad49a3b3f0d332b13621d7f6066cc8892">canReceive()</a>, <a class="el" href="group___c_a_n.html#ga5232071ac81ca92aab60b61af4c0260c">canTransmit()</a>, <a class="el" href="group__mailboxes.html#gadc562242a8854497a1f9539cb9ffea09">chMBFetchS()</a>, <a class="el" href="group__mailboxes.html#gaa9c91c0b781bec0df3540407d75b1bb3">chMBPostAheadS()</a>, <a class="el" href="group__mailboxes.html#gac6514c185ae87c2633132478ea48d689">chMBPostS()</a>, <a class="el" href="group__semaphores.html#ga0bc227311e5be3e3b6e3aee6a68169da">chSemWaitTimeout()</a>, <a class="el" href="group___m_a_c.html#ga151a33674ef86c2403ac7797fa87805c">macWaitReceiveDescriptor()</a>, and <a class="el" href="group___m_a_c.html#ga7304721038db1d7c0cb616c9c4d3f0ce">macWaitTransmitDescriptor()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_ga924ec5d191bb8debe8727ae4dd5d6d03_cgraph.png" border="0" usemap="#group__semaphores_ga924ec5d191bb8debe8727ae4dd5d6d03_cgraph" alt=""/></div>
<map name="group__semaphores_ga924ec5d191bb8debe8727ae4dd5d6d03_cgraph" id="group__semaphores_ga924ec5d191bb8debe8727ae4dd5d6d03_cgraph">
<area shape="rect" id="node2" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="557,7,688,31"/><area shape="rect" id="node4" href="group__scheduler.html#ga306e564f678c1a39139639490c77e78b" title="Puts the current thread to sleep into the specified state with timeout specification. " alt="" coords="191,55,349,79"/><area shape="rect" id="node3" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="736,55,823,79"/><area shape="rect" id="node5" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986" title="Puts the current thread to sleep into the specified state. " alt="" coords="397,55,509,79"/><area shape="rect" id="node7" href="group__time.html#ga680d851a74e594cc965101e79891840f" title="Disables a Virtual Timer. " alt="" coords="411,103,495,127"/><area shape="rect" id="node9" href="group__time.html#ga1c44c3a0bc64b2954d95cd98b2e7124e" title="Enables a virtual timer. " alt="" coords="418,151,489,175"/><area shape="rect" id="node6" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="578,55,667,79"/><area shape="rect" id="node8" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="559,103,686,127"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga7ec0cbda23e49e2370e0b91f20baf05e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chSemSignal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a signal operation on a semaphore. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00278">278</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__scheduler.html#gae47a8819a21ef2d521124e76bfb37c95">chSchWakeupS()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>, <a class="el" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a">fifo_remove()</a>, <a class="el" href="group__internals.html#gadf402c10356566d82a6631c102b7f656">isempty</a>, <a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>, <a class="el" href="group__scheduler.html#gae1c86078318e11c2fa57ee3c2ec69f61">RDY_OK</a>, <a class="el" href="struct_semaphore.html#ae42955cd2346167681e0fd6a136369cd">Semaphore::s_cnt</a>, and <a class="el" href="struct_semaphore.html#a26051a38c22dc11a7a2bf37496d8e906">Semaphore::s_queue</a>.</p>

<p>Referenced by <a class="el" href="group___a_d_c.html#gad8464418eb0ad2574872e695fcf1e3a7">adcReleaseBus()</a>, <a class="el" href="group___i2_c.html#gaa160950f37e5ebca45c3ed58d22b4ece">i2cReleaseBus()</a>, and <a class="el" href="group___s_p_i.html#ga1b04a2410ef4323ee4e37c63f320c18f">spiReleaseBus()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_ga7ec0cbda23e49e2370e0b91f20baf05e_cgraph.png" border="0" usemap="#group__semaphores_ga7ec0cbda23e49e2370e0b91f20baf05e_cgraph" alt=""/></div>
<map name="group__semaphores_ga7ec0cbda23e49e2370e0b91f20baf05e_cgraph" id="group__semaphores_ga7ec0cbda23e49e2370e0b91f20baf05e_cgraph">
<area shape="rect" id="node2" href="group__scheduler.html#gae47a8819a21ef2d521124e76bfb37c95" title="Wakes up a thread. " alt="" coords="149,28,256,52"/><area shape="rect" id="node7" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="158,76,247,100"/><area shape="rect" id="node3" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="445,5,576,29"/><area shape="rect" id="node5" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="304,53,397,77"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="624,29,711,53"/><area shape="rect" id="node6" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="447,53,574,77"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaca0b70cf495a9cb7569e1cf5b07e2b3d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chSemSignalI </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a signal operation on a semaphore. </p>
<dl class="section post"><dt>Postcondition</dt><dd>This function does not reschedule so a call to a rescheduling function must be performed before unlocking the kernel. Note that interrupt handlers always reschedule on exit so an explicit reschedule must not be performed in ISRs.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>I-Class</b> API, this function can be invoked from within a system lock zone by both threads and interrupt handlers. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00303">303</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470">chDbgCheckClassI()</a>, <a class="el" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298">chSchReadyI()</a>, <a class="el" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a">fifo_remove()</a>, <a class="el" href="group__internals.html#gadf402c10356566d82a6631c102b7f656">isempty</a>, <a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>, <a class="el" href="struct_thread.html#a72cd0424b6098ca241fac1f74d21b56a">Thread::p_u</a>, <a class="el" href="group__scheduler.html#gae1c86078318e11c2fa57ee3c2ec69f61">RDY_OK</a>, <a class="el" href="struct_thread.html#ad5792c30fbd60df0de223b0f398fc6d7">Thread::rdymsg</a>, <a class="el" href="struct_semaphore.html#ae42955cd2346167681e0fd6a136369cd">Semaphore::s_cnt</a>, and <a class="el" href="struct_semaphore.html#a26051a38c22dc11a7a2bf37496d8e906">Semaphore::s_queue</a>.</p>

<p>Referenced by <a class="el" href="group__mailboxes.html#ga2f32b9cf32c53a7de3d19d9bf814a853">chMBFetchI()</a>, <a class="el" href="group__mailboxes.html#gadc562242a8854497a1f9539cb9ffea09">chMBFetchS()</a>, <a class="el" href="group__mailboxes.html#ga66acd486f591d0092818dbcf95af2a03">chMBPostAheadI()</a>, <a class="el" href="group__mailboxes.html#gaa9c91c0b781bec0df3540407d75b1bb3">chMBPostAheadS()</a>, <a class="el" href="group__mailboxes.html#ga36c100f2c7ba41d88ad8867b0d2b2401">chMBPostI()</a>, and <a class="el" href="group__mailboxes.html#gac6514c185ae87c2633132478ea48d689">chMBPostS()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_gaca0b70cf495a9cb7569e1cf5b07e2b3d_cgraph.png" border="0" usemap="#group__semaphores_gaca0b70cf495a9cb7569e1cf5b07e2b3d_cgraph" alt=""/></div>
<map name="group__semaphores_gaca0b70cf495a9cb7569e1cf5b07e2b3d_cgraph" id="group__semaphores_gaca0b70cf495a9cb7569e1cf5b07e2b3d_cgraph">
<area shape="rect" id="node2" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="293,5,420,29"/><area shape="rect" id="node4" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="152,29,245,53"/><area shape="rect" id="node5" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="154,77,243,101"/><area shape="rect" id="node3" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="468,5,555,29"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gae4e4d20901d3ac1ad24f68373ac10b0e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chSemAddCounterI </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__types.html#ga090b3bab5602157ebf706a44041dc05e">cnt_t</a>&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds the specified value to the semaphore counter. </p>
<dl class="section post"><dt>Postcondition</dt><dd>This function does not reschedule so a call to a rescheduling function must be performed before unlocking the kernel. Note that interrupt handlers always reschedule on exit so an explicit reschedule must not be performed in ISRs.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sp</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>value to be added to the semaphore counter. The value must be positive.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>I-Class</b> API, this function can be invoked from within a system lock zone by both threads and interrupt handlers. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00334">334</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470">chDbgCheckClassI()</a>, <a class="el" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298">chSchReadyI()</a>, <a class="el" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a">fifo_remove()</a>, <a class="el" href="group__internals.html#gadf402c10356566d82a6631c102b7f656">isempty</a>, <a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>, <a class="el" href="struct_thread.html#a72cd0424b6098ca241fac1f74d21b56a">Thread::p_u</a>, <a class="el" href="group__scheduler.html#gae1c86078318e11c2fa57ee3c2ec69f61">RDY_OK</a>, <a class="el" href="struct_thread.html#ad5792c30fbd60df0de223b0f398fc6d7">Thread::rdymsg</a>, <a class="el" href="struct_semaphore.html#ae42955cd2346167681e0fd6a136369cd">Semaphore::s_cnt</a>, and <a class="el" href="struct_semaphore.html#a26051a38c22dc11a7a2bf37496d8e906">Semaphore::s_queue</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_gae4e4d20901d3ac1ad24f68373ac10b0e_cgraph.png" border="0" usemap="#group__semaphores_gae4e4d20901d3ac1ad24f68373ac10b0e_cgraph" alt=""/></div>
<map name="group__semaphores_gae4e4d20901d3ac1ad24f68373ac10b0e_cgraph" id="group__semaphores_gae4e4d20901d3ac1ad24f68373ac10b0e_cgraph">
<area shape="rect" id="node2" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="325,5,452,29"/><area shape="rect" id="node4" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="184,29,277,53"/><area shape="rect" id="node5" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="186,77,275,101"/><area shape="rect" id="node3" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="500,5,587,29"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga0dc7b4339506de346d67b4560b271e44"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__types.html#ga35bcb0c321cd7bc45bf1a11fa17ebdd3">msg_t</a> chSemSignalWait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>sps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_semaphore.html">Semaphore</a> *&#160;</td>
          <td class="paramname"><em>spw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs atomic signal and wait operations on two semaphores. </p>
<dl class="section pre"><dt>Precondition</dt><dd>The configuration option <code>CH_USE_SEMSW</code> must be enabled in order to use this function.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sps</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure to be signaled </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spw</td><td>pointer to a <code><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a></code> structure to wait on </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A message specifying how the invoking thread has been released from the semaphore. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RDY_OK</td><td>if the thread has not stopped on the semaphore or the semaphore has been signaled. </td></tr>
    <tr><td class="paramname">RDY_RESET</td><td>if the semaphore has been reset using <code><a class="el" href="group__semaphores.html#ga58e266e609cfd3dbc67f299b3ae9debb" title="Performs a reset operation on the semaphore. ">chSemReset()</a></code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8c_source.html#l00366">366</a> of file <a class="el" href="chsem_8c_source.html">chsem.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986">chSchGoSleepS()</a>, <a class="el" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298">chSchReadyI()</a>, <a class="el" href="group__scheduler.html#ga4e38b4bee3d2330f6a0f1cdb7660af20">chSchRescheduleS()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>, <a class="el" href="group__scheduler.html#ga1a5fddde56420e8accd0c09c1abb32a7">currp</a>, <a class="el" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a">fifo_remove()</a>, <a class="el" href="group__internals.html#gadf402c10356566d82a6631c102b7f656">isempty</a>, <a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>, <a class="el" href="struct_thread.html#a72cd0424b6098ca241fac1f74d21b56a">Thread::p_u</a>, <a class="el" href="group__scheduler.html#gae1c86078318e11c2fa57ee3c2ec69f61">RDY_OK</a>, <a class="el" href="struct_thread.html#ad5792c30fbd60df0de223b0f398fc6d7">Thread::rdymsg</a>, <a class="el" href="struct_semaphore.html#ae42955cd2346167681e0fd6a136369cd">Semaphore::s_cnt</a>, <a class="el" href="struct_semaphore.html#a26051a38c22dc11a7a2bf37496d8e906">Semaphore::s_queue</a>, <a class="el" href="group__threads.html#gad0b81cae859c0a6bc6a0d2036aa8e272">THD_STATE_WTSEM</a>, and <a class="el" href="struct_thread.html#a4f016b01444741e6f9b420436b748862">Thread::wtobjp</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__semaphores_ga0dc7b4339506de346d67b4560b271e44_cgraph.png" border="0" usemap="#group__semaphores_ga0dc7b4339506de346d67b4560b271e44_cgraph" alt=""/></div>
<map name="group__semaphores_ga0dc7b4339506de346d67b4560b271e44_cgraph" id="group__semaphores_ga0dc7b4339506de346d67b4560b271e44_cgraph">
<area shape="rect" id="node2" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986" title="Puts the current thread to sleep into the specified state. " alt="" coords="181,92,293,116"/><area shape="rect" id="node5" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="568,152,657,176"/><area shape="rect" id="node6" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="190,19,283,43"/><area shape="rect" id="node8" href="group__scheduler.html#ga4e38b4bee3d2330f6a0f1cdb7660af20" title="Performs a reschedule if a higher priority thread is runnable. " alt="" coords="172,140,301,164"/><area shape="rect" id="node3" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="369,104,500,128"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="569,55,656,79"/><area shape="rect" id="node7" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="371,5,498,29"/><area shape="rect" id="node9" href="group__scheduler.html#ga6827a67e839462e65b5765ef15709c97" title="Switches to the first thread on the runnable queue. " alt="" coords="349,152,520,176"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga1100c867cc8bd8328f7a7db5e7c74f6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _SEMAPHORE_DATA</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">n&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;{<a class="el" href="group__internals.html#ga9ac5ac4cb62a9baa48d2004876852112">_THREADSQUEUE_DATA</a>(name.s_queue), n}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Data part of a static semaphore initializer. </p>
<p>This macro should be used when statically initializing a semaphore that is part of a bigger structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>the name of the semaphore variable </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>the counter initial value, this value must be non-negative </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="chsem_8h_source.html#l00079">79</a> of file <a class="el" href="chsem_8h_source.html">chsem.h</a>.</p>

</div>
</div>
<a class="anchor" id="gac09ac6a24cd3dbe91ac13d72bebf67c1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEMAPHORE_DECL</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">n&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="struct_semaphore.html">Semaphore</a> name = <a class="el" href="group__semaphores.html#ga1100c867cc8bd8328f7a7db5e7c74f6d">_SEMAPHORE_DATA</a>(name, n)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Static semaphore initializer. </p>
<p>Statically initialized semaphores require no explicit initialization using <code><a class="el" href="group__semaphores.html#gafe8fc6155a871074e8017efd908b2c58" title="Initializes a semaphore with the specified counter value. ">chSemInit()</a></code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>the name of the semaphore variable </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>the counter initial value, this value must be non-negative </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="chsem_8h_source.html#l00090">90</a> of file <a class="el" href="chsem_8h_source.html">chsem.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga748b56bc2be187e316496d7b6e748f89"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define chSemFastWaitI</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">sp</td><td>)</td>
          <td>&#160;&#160;&#160;((sp)-&gt;s_cnt--)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decreases the semaphore counter. </p>
<p>This macro can be used when the counter is known to be positive.</p>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>I-Class</b> API, this function can be invoked from within a system lock zone by both threads and interrupt handlers. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8h_source.html#l00102">102</a> of file <a class="el" href="chsem_8h_source.html">chsem.h</a>.</p>

<p>Referenced by <a class="el" href="group__mailboxes.html#ga2f32b9cf32c53a7de3d19d9bf814a853">chMBFetchI()</a>, <a class="el" href="group__mailboxes.html#ga66acd486f591d0092818dbcf95af2a03">chMBPostAheadI()</a>, and <a class="el" href="group__mailboxes.html#ga36c100f2c7ba41d88ad8867b0d2b2401">chMBPostI()</a>.</p>

</div>
</div>
<a class="anchor" id="gacb89a28bd1fff2704207423f350215ba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define chSemFastSignalI</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">sp</td><td>)</td>
          <td>&#160;&#160;&#160;((sp)-&gt;s_cnt++)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Increases the semaphore counter. </p>
<p>This macro can be used when the counter is known to be not negative.</p>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>I-Class</b> API, this function can be invoked from within a system lock zone by both threads and interrupt handlers. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8h_source.html#l00111">111</a> of file <a class="el" href="chsem_8h_source.html">chsem.h</a>.</p>

</div>
</div>
<a class="anchor" id="gadab3ccf8a34988ef6d410354b2648327"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define chSemGetCounterI</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">sp</td><td>)</td>
          <td>&#160;&#160;&#160;((sp)-&gt;s_cnt)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the semaphore counter current value. </p>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>I-Class</b> API, this function can be invoked from within a system lock zone by both threads and interrupt handlers. </dd></dl>

<p>Definition at line <a class="el" href="chsem_8h_source.html#l00118">118</a> of file <a class="el" href="chsem_8h_source.html">chsem.h</a>.</p>

<p>Referenced by <a class="el" href="group__mailboxes.html#ga2f32b9cf32c53a7de3d19d9bf814a853">chMBFetchI()</a>, <a class="el" href="group__mailboxes.html#ga66acd486f591d0092818dbcf95af2a03">chMBPostAheadI()</a>, and <a class="el" href="group__mailboxes.html#ga36c100f2c7ba41d88ad8867b0d2b2401">chMBPostI()</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="gac28c458b44903a8093398ef50333c513"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct_semaphore.html">Semaphore</a>  <a class="el" href="struct_semaphore.html">Semaphore</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="struct_semaphore.html" title="Semaphore structure. ">Semaphore</a> structure. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
    <li class="footer">
      <a href="http://sourceforge.net/projects/chibios">
        <img src="http://sflogo.sourceforge.net/sflogo.php?group_id=205897&amp;type=11"
             border="0" width="120" height="30"
             alt="Get ChibiOS/RT embedded RTOS at SourceForge.net. Fast,
                  secure and Free Open Source software downloads"/>
      </a>
    </li>
  </ul>
</div>
<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://apps.sourceforge.net/piwik/chibios/" : "http://apps.sourceforge.net/piwik/chibios/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 1;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p><img src="http://apps.sourceforge.net/piwik/chibios/piwik.php?idsite=1" alt="piwik"/></p></noscript></object>
<!-- End Piwik Tag -->
</body>
</html>
