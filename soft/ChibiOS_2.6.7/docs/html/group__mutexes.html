<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Mutexes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 92px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ChibiOS/RT<br><span id="projectnumber">2.6.7</span></div>
  </td>
  <td style="padding-left: 3em;">
<script type="text/javascript"><!--
google_ad_client = "pub-3840594581853944";
/* Documentation, bottom, 728x90, created 9/19/10 */
google_ad_slot = "1902290615";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__mutexes.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a>  </div>
  <div class="headertitle">
<div class="title">Mutexes<div class="ingroups"><a class="el" href="group__kernel.html">Kernel</a> &raquo; <a class="el" href="group__synchronization.html">Synchronization</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Mutexes:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__mutexes.png" border="0" alt="" usemap="#group____mutexes"/>
<map name="group____mutexes" id="group____mutexes">
<area shape="rect" id="node1" href="group__synchronization.html" title="Synchronization" alt="" coords="5,5,116,29"/></map>
</td></tr></table></center>
</div>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Mutexes related APIs and services. </p><pre class="fragment">     &lt;h2&gt;Operation mode&lt;/h2&gt;
     A mutex is a threads synchronization object that can be in two
     distinct states:
     - Not owned (unlocked).
     - Owned by a thread (locked).
     .
     Operations defined for mutexes:
     - &lt;b&gt;Lock&lt;/b&gt;: The mutex is checked, if the mutex is not owned by
       some other thread then it is associated to the locking thread
       else the thread is queued on the mutex in a list ordered by
       priority.
     - &lt;b&gt;Unlock&lt;/b&gt;: The mutex is released by the owner and the highest
       priority thread waiting in the queue, if any, is resumed and made
       owner of the mutex.
     .
     &lt;h2&gt;Constraints&lt;/h2&gt;
     In ChibiOS/RT the Unlock operations are always performed in
     lock-reverse order. The unlock API does not even have a parameter,
     the mutex to unlock is selected from an internal, per-thread, stack
     of owned mutexes. This both improves the performance and is
     required for an efficient implementation of the priority
     inheritance mechanism.

     &lt;h2&gt;The priority inversion problem&lt;/h2&gt;
     The mutexes in ChibiOS/RT implements the &lt;b&gt;full&lt;/b&gt; priority
     inheritance mechanism in order handle the priority inversion
     problem.&lt;br&gt;
     When a thread is queued on a mutex, any thread, directly or
     indirectly, holding the mutex gains the same priority of the
     waiting thread (if their priority was not already equal or higher).
     The mechanism works with any number of nested mutexes and any
     number of involved threads. The algorithm complexity (worst case)
     is N with N equal to the number of nested mutexes.
</pre> <dl class="section pre"><dt>Precondition</dt><dd>In order to use the mutex APIs the <code>CH_USE_MUTEXES</code> option must be enabled in <code><a class="el" href="chconf_8h.html" title="Configuration file template. ">chconf.h</a></code>. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Enabling mutexes requires 5-12 (depending on the architecture) extra bytes in the <code><a class="el" href="struct_thread.html" title="Structure representing a thread. ">Thread</a></code> structure. </dd></dl>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_mutex.html">Mutex</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a> structure.  <a href="struct_mutex.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac55fe4d05aa6bbeb31594193d2e4d2b6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#gac55fe4d05aa6bbeb31594193d2e4d2b6">chMtxInit</a> (<a class="el" href="struct_mutex.html">Mutex</a> *mp)</td></tr>
<tr class="memdesc:gac55fe4d05aa6bbeb31594193d2e4d2b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes s <code><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a></code> structure.  <a href="#gac55fe4d05aa6bbeb31594193d2e4d2b6">More...</a><br /></td></tr>
<tr class="separator:gac55fe4d05aa6bbeb31594193d2e4d2b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafa06b82e3496c44eb7bf31d9f1b655ba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#gafa06b82e3496c44eb7bf31d9f1b655ba">chMtxLock</a> (<a class="el" href="struct_mutex.html">Mutex</a> *mp)</td></tr>
<tr class="memdesc:gafa06b82e3496c44eb7bf31d9f1b655ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locks the specified mutex.  <a href="#gafa06b82e3496c44eb7bf31d9f1b655ba">More...</a><br /></td></tr>
<tr class="separator:gafa06b82e3496c44eb7bf31d9f1b655ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2d6350c2d147d1165c359f30798205f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#ga2d6350c2d147d1165c359f30798205f5">chMtxLockS</a> (<a class="el" href="struct_mutex.html">Mutex</a> *mp)</td></tr>
<tr class="memdesc:ga2d6350c2d147d1165c359f30798205f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locks the specified mutex.  <a href="#ga2d6350c2d147d1165c359f30798205f5">More...</a><br /></td></tr>
<tr class="separator:ga2d6350c2d147d1165c359f30798205f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaada14e216460dc55e1816234168cf95c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__types.html#ga7556af1cb61728b53228fa3af1c851de">bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#gaada14e216460dc55e1816234168cf95c">chMtxTryLock</a> (<a class="el" href="struct_mutex.html">Mutex</a> *mp)</td></tr>
<tr class="memdesc:gaada14e216460dc55e1816234168cf95c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tries to lock a mutex.  <a href="#gaada14e216460dc55e1816234168cf95c">More...</a><br /></td></tr>
<tr class="separator:gaada14e216460dc55e1816234168cf95c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadbf0bd4a36b1f7e33ee41939df32ab78"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__types.html#ga7556af1cb61728b53228fa3af1c851de">bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#gadbf0bd4a36b1f7e33ee41939df32ab78">chMtxTryLockS</a> (<a class="el" href="struct_mutex.html">Mutex</a> *mp)</td></tr>
<tr class="memdesc:gadbf0bd4a36b1f7e33ee41939df32ab78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tries to lock a mutex.  <a href="#gadbf0bd4a36b1f7e33ee41939df32ab78">More...</a><br /></td></tr>
<tr class="separator:gadbf0bd4a36b1f7e33ee41939df32ab78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae9ae07165126c9f6c0ce0b17bdb53669"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_mutex.html">Mutex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#gae9ae07165126c9f6c0ce0b17bdb53669">chMtxUnlock</a> (void)</td></tr>
<tr class="memdesc:gae9ae07165126c9f6c0ce0b17bdb53669"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlocks the next owned mutex in reverse lock order.  <a href="#gae9ae07165126c9f6c0ce0b17bdb53669">More...</a><br /></td></tr>
<tr class="separator:gae9ae07165126c9f6c0ce0b17bdb53669"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga705fa60fb8aa28a6632f693e83f78c96"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_mutex.html">Mutex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#ga705fa60fb8aa28a6632f693e83f78c96">chMtxUnlockS</a> (void)</td></tr>
<tr class="memdesc:ga705fa60fb8aa28a6632f693e83f78c96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlocks the next owned mutex in reverse lock order.  <a href="#ga705fa60fb8aa28a6632f693e83f78c96">More...</a><br /></td></tr>
<tr class="separator:ga705fa60fb8aa28a6632f693e83f78c96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga853b4ced43d22fb5d82678dd2f0aba75"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#ga853b4ced43d22fb5d82678dd2f0aba75">chMtxUnlockAll</a> (void)</td></tr>
<tr class="memdesc:ga853b4ced43d22fb5d82678dd2f0aba75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlocks all the mutexes owned by the invoking thread.  <a href="#ga853b4ced43d22fb5d82678dd2f0aba75">More...</a><br /></td></tr>
<tr class="separator:ga853b4ced43d22fb5d82678dd2f0aba75"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Macro Functions</h2></td></tr>
<tr class="memitem:ga322ebcfba68cf5b66b9c315638e3ae63"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#ga322ebcfba68cf5b66b9c315638e3ae63">chMtxQueueNotEmptyS</a>(mp)&#160;&#160;&#160;<a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>(&amp;(mp)-&gt;m_queue)</td></tr>
<tr class="memdesc:ga322ebcfba68cf5b66b9c315638e3ae63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns <code>TRUE</code> if the mutex queue contains at least a waiting thread.  <a href="#ga322ebcfba68cf5b66b9c315638e3ae63">More...</a><br /></td></tr>
<tr class="separator:ga322ebcfba68cf5b66b9c315638e3ae63"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga01a9ed719f222e64589413d6eda7396e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#ga01a9ed719f222e64589413d6eda7396e">_MUTEX_DATA</a>(name)&#160;&#160;&#160;{<a class="el" href="group__internals.html#ga9ac5ac4cb62a9baa48d2004876852112">_THREADSQUEUE_DATA</a>(name.m_queue), NULL, NULL}</td></tr>
<tr class="memdesc:ga01a9ed719f222e64589413d6eda7396e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data part of a static mutex initializer.  <a href="#ga01a9ed719f222e64589413d6eda7396e">More...</a><br /></td></tr>
<tr class="separator:ga01a9ed719f222e64589413d6eda7396e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0461d963db5d730f1829eb783f6fdf94"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#ga0461d963db5d730f1829eb783f6fdf94">MUTEX_DECL</a>(name)&#160;&#160;&#160;<a class="el" href="struct_mutex.html">Mutex</a> name = <a class="el" href="group__mutexes.html#ga01a9ed719f222e64589413d6eda7396e">_MUTEX_DATA</a>(name)</td></tr>
<tr class="memdesc:ga0461d963db5d730f1829eb783f6fdf94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Static mutex initializer.  <a href="#ga0461d963db5d730f1829eb783f6fdf94">More...</a><br /></td></tr>
<tr class="separator:ga0461d963db5d730f1829eb783f6fdf94"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga9b2dfabf6db35faa7fd04ea30834012d"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct_mutex.html">Mutex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mutexes.html#ga9b2dfabf6db35faa7fd04ea30834012d">Mutex</a></td></tr>
<tr class="memdesc:ga9b2dfabf6db35faa7fd04ea30834012d"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a> structure.  <a href="#ga9b2dfabf6db35faa7fd04ea30834012d">More...</a><br /></td></tr>
<tr class="separator:ga9b2dfabf6db35faa7fd04ea30834012d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gac55fe4d05aa6bbeb31594193d2e4d2b6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chMtxInit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mutex.html">Mutex</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes s <code><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a></code> structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">mp</td><td>pointer to a <code><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a></code> structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Initializer, this function just initializes an object and can be invoked before the kernel is initialized. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8c_source.html#l00086">86</a> of file <a class="el" href="chmtx_8c_source.html">chmtx.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="struct_mutex.html#ad83ff6b7d8b483f91a080ae8c53a4941">Mutex::m_owner</a>, <a class="el" href="struct_mutex.html#ad3efd6941b40b1415b5fe40e804d4b6f">Mutex::m_queue</a>, and <a class="el" href="group__internals.html#ga6d19d0f3ff1fa599b6d9783dec180451">queue_init</a>.</p>

<p>Referenced by <a class="el" href="group__heaps.html#ga777708769d35996ed5f0d8bd4642217c">_heap_init()</a>, <a class="el" href="group___a_d_c.html#gac7f619e304c79c17f19221d05138d405">adcObjectInit()</a>, <a class="el" href="group__heaps.html#ga7135c9ddbd1402a4a36ce44df948f4e4">chHeapInit()</a>, <a class="el" href="group___i2_c.html#ga2dd7be686d8e136b1deebfeb20e868f9">i2cObjectInit()</a>, and <a class="el" href="group___s_p_i.html#ga87a7bdc554b8e8fdfc77064e67689fcf">spiObjectInit()</a>.</p>

</div>
</div>
<a class="anchor" id="gafa06b82e3496c44eb7bf31d9f1b655ba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chMtxLock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mutex.html">Mutex</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Locks the specified mutex. </p>
<dl class="section post"><dt>Postcondition</dt><dd>The mutex is locked and inserted in the per-thread stack of owned mutexes.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>pointer to the <code><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a></code> structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8c_source.html#l00103">103</a> of file <a class="el" href="chmtx_8c_source.html">chmtx.c</a>.</p>

<p>References <a class="el" href="group__mutexes.html#ga2d6350c2d147d1165c359f30798205f5">chMtxLockS()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, and <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>.</p>

<p>Referenced by <a class="el" href="group___a_d_c.html#ga61ae6a7495100110e7b6fd46a6693a02">adcAcquireBus()</a>, <a class="el" href="group___i2_c.html#gace46540c237d310d9ea09f1adfcdb6d5">i2cAcquireBus()</a>, and <a class="el" href="group___s_p_i.html#ga803cec73f6dd8d3d1f18fb6a61b8255a">spiAcquireBus()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__mutexes_gafa06b82e3496c44eb7bf31d9f1b655ba_cgraph.png" border="0" usemap="#group__mutexes_gafa06b82e3496c44eb7bf31d9f1b655ba_cgraph" alt=""/></div>
<map name="group__mutexes_gafa06b82e3496c44eb7bf31d9f1b655ba_cgraph" id="group__mutexes_gafa06b82e3496c44eb7bf31d9f1b655ba_cgraph">
<area shape="rect" id="node2" href="group__mutexes.html#ga2d6350c2d147d1165c359f30798205f5" title="Locks the specified mutex. " alt="" coords="132,101,219,125"/><area shape="rect" id="node3" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="427,151,557,175"/><area shape="rect" id="node5" href="group__internals.html#ga02226b866ae704435baf2ffe259ba0b2" title="Inserts a thread into a priority ordered queue. " alt="" coords="281,53,364,77"/><area shape="rect" id="node6" href="group__internals.html#gafff11bcd31d7dc3d1a0a6c66f3fc6ec9" title="Removes a Thread from a queue and returns it. " alt="" coords="287,101,358,125"/><area shape="rect" id="node7" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="276,5,369,29"/><area shape="rect" id="node9" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986" title="Puts the current thread to sleep into the specified state. " alt="" coords="267,200,379,224"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="605,103,692,127"/><area shape="rect" id="node8" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="429,55,555,79"/><area shape="rect" id="node10" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="447,200,537,224"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga2d6350c2d147d1165c359f30798205f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chMtxLockS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mutex.html">Mutex</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Locks the specified mutex. </p>
<dl class="section post"><dt>Postcondition</dt><dd>The mutex is locked and inserted in the per-thread stack of owned mutexes.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>pointer to the <code><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a></code> structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>S-Class</b> API, this function can be invoked from within a system lock zone by threads only. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8c_source.html#l00121">121</a> of file <a class="el" href="chmtx_8c_source.html">chmtx.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167">chDbgCheckClassS()</a>, <a class="el" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986">chSchGoSleepS()</a>, <a class="el" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298">chSchReadyI()</a>, <a class="el" href="group__scheduler.html#ga1a5fddde56420e8accd0c09c1abb32a7">currp</a>, <a class="el" href="group__internals.html#gafff11bcd31d7dc3d1a0a6c66f3fc6ec9">dequeue()</a>, <a class="el" href="struct_mutex.html#aa2113b554e5f0deefbc20dbadfd3d1dd">Mutex::m_next</a>, <a class="el" href="struct_mutex.html#ad83ff6b7d8b483f91a080ae8c53a4941">Mutex::m_owner</a>, <a class="el" href="struct_mutex.html#ad3efd6941b40b1415b5fe40e804d4b6f">Mutex::m_queue</a>, <a class="el" href="struct_thread.html#a3ae80b4b3de4c7a23c542ca251e1f017">Thread::p_mtxlist</a>, <a class="el" href="struct_thread.html#ae60cc22956f4c19965cb94045333aa9c">Thread::p_prio</a>, <a class="el" href="struct_thread.html#a3c3e9d6abccb62c3a5fab6ef043a391f">Thread::p_state</a>, <a class="el" href="struct_thread.html#a72cd0424b6098ca241fac1f74d21b56a">Thread::p_u</a>, <a class="el" href="group__internals.html#ga02226b866ae704435baf2ffe259ba0b2">prio_insert()</a>, <a class="el" href="group__threads.html#ga247c4d33e862f51e90df9a602175f80b">THD_STATE_CURRENT</a>, <a class="el" href="group__threads.html#ga1f7b83c73a5b850a3f33bddbdb024fb3">THD_STATE_READY</a>, <a class="el" href="group__threads.html#gac1ef7f400c8679cae9225f939b32eced">THD_STATE_SNDMSGQ</a>, <a class="el" href="group__threads.html#ga286c5b1a6459d654d5794fc17e93c939">THD_STATE_WTCOND</a>, <a class="el" href="group__threads.html#gac18de5096ff3c841e69672cab0868cdf">THD_STATE_WTMTX</a>, <a class="el" href="group__threads.html#gad0b81cae859c0a6bc6a0d2036aa8e272">THD_STATE_WTSEM</a>, and <a class="el" href="struct_thread.html#a4f016b01444741e6f9b420436b748862">Thread::wtobjp</a>.</p>

<p>Referenced by <a class="el" href="group__condvars.html#gab6357d80b01ed8d225ef1e30a66248f9">chCondWaitS()</a>, <a class="el" href="group__condvars.html#ga9cf6ebe4c9f28cb206fab14984a18d29">chCondWaitTimeoutS()</a>, and <a class="el" href="group__mutexes.html#gafa06b82e3496c44eb7bf31d9f1b655ba">chMtxLock()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__mutexes_ga2d6350c2d147d1165c359f30798205f5_cgraph.png" border="0" usemap="#group__mutexes_ga2d6350c2d147d1165c359f30798205f5_cgraph" alt=""/></div>
<map name="group__mutexes_ga2d6350c2d147d1165c359f30798205f5_cgraph" id="group__mutexes_ga2d6350c2d147d1165c359f30798205f5_cgraph">
<area shape="rect" id="node2" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="300,5,431,29"/><area shape="rect" id="node4" href="group__scheduler.html#ga97c1c514b755a1e71caf2f19c1ccf986" title="Puts the current thread to sleep into the specified state. " alt="" coords="140,53,252,77"/><area shape="rect" id="node6" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="149,101,243,125"/><area shape="rect" id="node8" href="group__internals.html#gafff11bcd31d7dc3d1a0a6c66f3fc6ec9" title="Removes a Thread from a queue and returns it. " alt="" coords="161,149,231,173"/><area shape="rect" id="node9" href="group__internals.html#ga02226b866ae704435baf2ffe259ba0b2" title="Inserts a thread into a priority ordered queue. " alt="" coords="155,197,237,221"/><area shape="rect" id="node3" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="479,53,565,77"/><area shape="rect" id="node5" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="321,53,410,77"/><area shape="rect" id="node7" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="302,101,429,125"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaada14e216460dc55e1816234168cf95c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__types.html#ga7556af1cb61728b53228fa3af1c851de">bool_t</a> chMtxTryLock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mutex.html">Mutex</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tries to lock a mutex. </p>
<p>This function attempts to lock a mutex, if the mutex is already locked by another thread then the function exits without waiting. </p><dl class="section post"><dt>Postcondition</dt><dd>The mutex is locked and inserted in the per-thread stack of owned mutexes. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function does not have any overhead related to the priority inheritance mechanism because it does not try to enter a sleep state.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>pointer to the <code><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a></code> structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The operation status. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">TRUE</td><td>if the mutex has been successfully acquired </td></tr>
    <tr><td class="paramname">FALSE</td><td>if the lock attempt failed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8c_source.html#l00206">206</a> of file <a class="el" href="chmtx_8c_source.html">chmtx.c</a>.</p>

<p>References <a class="el" href="group__mutexes.html#gadbf0bd4a36b1f7e33ee41939df32ab78">chMtxTryLockS()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, and <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__mutexes_gaada14e216460dc55e1816234168cf95c_cgraph.png" border="0" usemap="#group__mutexes_gaada14e216460dc55e1816234168cf95c_cgraph" alt=""/></div>
<map name="group__mutexes_gaada14e216460dc55e1816234168cf95c_cgraph" id="group__mutexes_gaada14e216460dc55e1816234168cf95c_cgraph">
<area shape="rect" id="node2" href="group__mutexes.html#gadbf0bd4a36b1f7e33ee41939df32ab78" title="Tries to lock a mutex. " alt="" coords="148,5,251,29"/><area shape="rect" id="node3" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="299,5,429,29"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="477,5,564,29"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gadbf0bd4a36b1f7e33ee41939df32ab78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__types.html#ga7556af1cb61728b53228fa3af1c851de">bool_t</a> chMtxTryLockS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mutex.html">Mutex</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tries to lock a mutex. </p>
<p>This function attempts to lock a mutex, if the mutex is already taken by another thread then the function exits without waiting. </p><dl class="section post"><dt>Postcondition</dt><dd>The mutex is locked and inserted in the per-thread stack of owned mutexes. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function does not have any overhead related to the priority inheritance mechanism because it does not try to enter a sleep state.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>pointer to the <code><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a></code> structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The operation status. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">TRUE</td><td>if the mutex has been successfully acquired </td></tr>
    <tr><td class="paramname">FALSE</td><td>if the lock attempt failed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>S-Class</b> API, this function can be invoked from within a system lock zone by threads only. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8c_source.html#l00234">234</a> of file <a class="el" href="chmtx_8c_source.html">chmtx.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga6bb6c0f97caab3a66332c8bfbf7a3844">chDbgCheck</a>, <a class="el" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167">chDbgCheckClassS()</a>, <a class="el" href="group__scheduler.html#ga1a5fddde56420e8accd0c09c1abb32a7">currp</a>, <a class="el" href="group__kernel__info.html#gaa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="el" href="struct_mutex.html#aa2113b554e5f0deefbc20dbadfd3d1dd">Mutex::m_next</a>, <a class="el" href="struct_mutex.html#ad83ff6b7d8b483f91a080ae8c53a4941">Mutex::m_owner</a>, and <a class="el" href="group__kernel__info.html#gaa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>.</p>

<p>Referenced by <a class="el" href="group__mutexes.html#gaada14e216460dc55e1816234168cf95c">chMtxTryLock()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__mutexes_gadbf0bd4a36b1f7e33ee41939df32ab78_cgraph.png" border="0" usemap="#group__mutexes_gadbf0bd4a36b1f7e33ee41939df32ab78_cgraph" alt=""/></div>
<map name="group__mutexes_gadbf0bd4a36b1f7e33ee41939df32ab78_cgraph" id="group__mutexes_gadbf0bd4a36b1f7e33ee41939df32ab78_cgraph">
<area shape="rect" id="node2" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="156,5,287,29"/><area shape="rect" id="node3" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="335,5,421,29"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gae9ae07165126c9f6c0ce0b17bdb53669"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_mutex.html">Mutex</a> * chMtxUnlock </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlocks the next owned mutex in reverse lock order. </p>
<dl class="section pre"><dt>Precondition</dt><dd>The invoking thread <b>must</b> have at least one owned mutex. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>The mutex is unlocked and removed from the per-thread stack of owned mutexes.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the unlocked mutex.</dd></dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8c_source.html#l00257">257</a> of file <a class="el" href="chmtx_8c_source.html">chmtx.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__mutexes.html#ga322ebcfba68cf5b66b9c315638e3ae63">chMtxQueueNotEmptyS</a>, <a class="el" href="group__scheduler.html#gae47a8819a21ef2d521124e76bfb37c95">chSchWakeupS()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>, <a class="el" href="group__scheduler.html#ga1a5fddde56420e8accd0c09c1abb32a7">currp</a>, <a class="el" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a">fifo_remove()</a>, <a class="el" href="struct_mutex.html#aa2113b554e5f0deefbc20dbadfd3d1dd">Mutex::m_next</a>, <a class="el" href="struct_mutex.html#ad83ff6b7d8b483f91a080ae8c53a4941">Mutex::m_owner</a>, <a class="el" href="struct_mutex.html#ad3efd6941b40b1415b5fe40e804d4b6f">Mutex::m_queue</a>, <a class="el" href="struct_thread.html#a3ae80b4b3de4c7a23c542ca251e1f017">Thread::p_mtxlist</a>, <a class="el" href="struct_threads_queue.html#af4a099c245d7ceecdf2f9755d05d0ed0">ThreadsQueue::p_next</a>, <a class="el" href="struct_thread.html#ae60cc22956f4c19965cb94045333aa9c">Thread::p_prio</a>, <a class="el" href="struct_thread.html#a38de11dd7f8cdcfbc45b2c467f400fe8">Thread::p_realprio</a>, and <a class="el" href="group__scheduler.html#gae1c86078318e11c2fa57ee3c2ec69f61">RDY_OK</a>.</p>

<p>Referenced by <a class="el" href="group___a_d_c.html#gad8464418eb0ad2574872e695fcf1e3a7">adcReleaseBus()</a>, <a class="el" href="group___i2_c.html#gaa160950f37e5ebca45c3ed58d22b4ece">i2cReleaseBus()</a>, and <a class="el" href="group___s_p_i.html#ga1b04a2410ef4323ee4e37c63f320c18f">spiReleaseBus()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__mutexes_gae9ae07165126c9f6c0ce0b17bdb53669_cgraph.png" border="0" usemap="#group__mutexes_gae9ae07165126c9f6c0ce0b17bdb53669_cgraph" alt=""/></div>
<map name="group__mutexes_gae9ae07165126c9f6c0ce0b17bdb53669_cgraph" id="group__mutexes_gae9ae07165126c9f6c0ce0b17bdb53669_cgraph">
<area shape="rect" id="node2" href="group__scheduler.html#gae47a8819a21ef2d521124e76bfb37c95" title="Wakes up a thread. " alt="" coords="144,28,251,52"/><area shape="rect" id="node7" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="153,76,242,100"/><area shape="rect" id="node3" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="440,5,571,29"/><area shape="rect" id="node5" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="299,53,392,77"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="619,29,705,53"/><area shape="rect" id="node6" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="442,53,569,77"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga705fa60fb8aa28a6632f693e83f78c96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_mutex.html">Mutex</a> * chMtxUnlockS </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlocks the next owned mutex in reverse lock order. </p>
<dl class="section pre"><dt>Precondition</dt><dd>The invoking thread <b>must</b> have at least one owned mutex. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>The mutex is unlocked and removed from the per-thread stack of owned mutexes. </dd>
<dd>
This function does not reschedule so a call to a rescheduling function must be performed before unlocking the kernel.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the unlocked mutex.</dd></dl>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>S-Class</b> API, this function can be invoked from within a system lock zone by threads only. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8c_source.html#l00317">317</a> of file <a class="el" href="chmtx_8c_source.html">chmtx.c</a>.</p>

<p>References <a class="el" href="group__debug.html#ga43d50c69eb730d0f024eb832d61f30c9">chDbgAssert</a>, <a class="el" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167">chDbgCheckClassS()</a>, <a class="el" href="group__mutexes.html#ga322ebcfba68cf5b66b9c315638e3ae63">chMtxQueueNotEmptyS</a>, <a class="el" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298">chSchReadyI()</a>, <a class="el" href="group__scheduler.html#ga1a5fddde56420e8accd0c09c1abb32a7">currp</a>, <a class="el" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a">fifo_remove()</a>, <a class="el" href="struct_mutex.html#aa2113b554e5f0deefbc20dbadfd3d1dd">Mutex::m_next</a>, <a class="el" href="struct_mutex.html#ad83ff6b7d8b483f91a080ae8c53a4941">Mutex::m_owner</a>, <a class="el" href="struct_mutex.html#ad3efd6941b40b1415b5fe40e804d4b6f">Mutex::m_queue</a>, <a class="el" href="struct_thread.html#a3ae80b4b3de4c7a23c542ca251e1f017">Thread::p_mtxlist</a>, <a class="el" href="struct_threads_queue.html#af4a099c245d7ceecdf2f9755d05d0ed0">ThreadsQueue::p_next</a>, <a class="el" href="struct_thread.html#ae60cc22956f4c19965cb94045333aa9c">Thread::p_prio</a>, and <a class="el" href="struct_thread.html#a38de11dd7f8cdcfbc45b2c467f400fe8">Thread::p_realprio</a>.</p>

<p>Referenced by <a class="el" href="group__condvars.html#gab6357d80b01ed8d225ef1e30a66248f9">chCondWaitS()</a>, and <a class="el" href="group__condvars.html#ga9cf6ebe4c9f28cb206fab14984a18d29">chCondWaitTimeoutS()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__mutexes_ga705fa60fb8aa28a6632f693e83f78c96_cgraph.png" border="0" usemap="#group__mutexes_ga705fa60fb8aa28a6632f693e83f78c96_cgraph" alt=""/></div>
<map name="group__mutexes_ga705fa60fb8aa28a6632f693e83f78c96_cgraph" id="group__mutexes_ga705fa60fb8aa28a6632f693e83f78c96_cgraph">
<area shape="rect" id="node2" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="293,5,424,29"/><area shape="rect" id="node4" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="152,53,245,77"/><area shape="rect" id="node6" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="154,101,243,125"/><area shape="rect" id="node3" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="472,29,559,53"/><area shape="rect" id="node5" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="295,53,422,77"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga853b4ced43d22fb5d82678dd2f0aba75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chMtxUnlockAll </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlocks all the mutexes owned by the invoking thread. </p>
<dl class="section post"><dt>Postcondition</dt><dd>The stack of owned mutexes is emptied and all the found mutexes are unlocked. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function is <b>MUCH MORE</b> efficient than releasing the mutexes one by one and not just because the call overhead, this function does not have any overhead related to the priority inheritance mechanism.</dd></dl>
<dl class="section user"><dt>Function Class:</dt><dd>Normal API, this function can be invoked by regular system threads but not from within a lock zone. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8c_source.html#l00374">374</a> of file <a class="el" href="chmtx_8c_source.html">chmtx.c</a>.</p>

<p>References <a class="el" href="group__mutexes.html#ga322ebcfba68cf5b66b9c315638e3ae63">chMtxQueueNotEmptyS</a>, <a class="el" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298">chSchReadyI()</a>, <a class="el" href="group__scheduler.html#ga4e38b4bee3d2330f6a0f1cdb7660af20">chSchRescheduleS()</a>, <a class="el" href="group__system.html#ga9f6573c0763d1e4e97c63c62edad6e42">chSysLock</a>, <a class="el" href="group__system.html#ga5a257fa58a09815eb64a45e2dfbdc22e">chSysUnlock</a>, <a class="el" href="group__scheduler.html#ga1a5fddde56420e8accd0c09c1abb32a7">currp</a>, <a class="el" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a">fifo_remove()</a>, <a class="el" href="struct_mutex.html#aa2113b554e5f0deefbc20dbadfd3d1dd">Mutex::m_next</a>, <a class="el" href="struct_mutex.html#ad83ff6b7d8b483f91a080ae8c53a4941">Mutex::m_owner</a>, <a class="el" href="struct_mutex.html#ad3efd6941b40b1415b5fe40e804d4b6f">Mutex::m_queue</a>, <a class="el" href="struct_thread.html#a3ae80b4b3de4c7a23c542ca251e1f017">Thread::p_mtxlist</a>, <a class="el" href="struct_thread.html#ae60cc22956f4c19965cb94045333aa9c">Thread::p_prio</a>, and <a class="el" href="struct_thread.html#a38de11dd7f8cdcfbc45b2c467f400fe8">Thread::p_realprio</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__mutexes_ga853b4ced43d22fb5d82678dd2f0aba75_cgraph.png" border="0" usemap="#group__mutexes_ga853b4ced43d22fb5d82678dd2f0aba75_cgraph" alt=""/></div>
<map name="group__mutexes_ga853b4ced43d22fb5d82678dd2f0aba75_cgraph" id="group__mutexes_ga853b4ced43d22fb5d82678dd2f0aba75_cgraph">
<area shape="rect" id="node2" href="group__scheduler.html#ga535d58cfb3436c8d4e4586c31c062298" title="Inserts a thread in the Ready List. " alt="" coords="175,17,269,41"/><area shape="rect" id="node5" href="group__scheduler.html#ga4e38b4bee3d2330f6a0f1cdb7660af20" title="Performs a reschedule if a higher priority thread is runnable. " alt="" coords="157,77,287,101"/><area shape="rect" id="node8" href="group__internals.html#ga042479f09357fc59befebf4dfe0e9f4a" title="Removes the first&#45;out Thread from a queue and returns it. " alt="" coords="553,113,643,137"/><area shape="rect" id="node3" href="group__debug.html#ga3e4782dccbb385051e1eb01ac5b05470" title="I&#45;class functions context check. " alt="" coords="357,5,483,29"/><area shape="rect" id="node4" href="group__debug.html#ga897718bcb144b5523b914633b0d824e1" title="Prints a panic message on the console and then halts the system. " alt="" coords="555,41,641,65"/><area shape="rect" id="node6" href="group__debug.html#ga14fe880e1dbd127d46077a1d300b1167" title="S&#45;class functions context check. " alt="" coords="355,53,485,77"/><area shape="rect" id="node7" href="group__scheduler.html#ga6827a67e839462e65b5765ef15709c97" title="Switches to the first thread on the runnable queue. " alt="" coords="335,101,505,125"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga01a9ed719f222e64589413d6eda7396e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _MUTEX_DATA</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name</td><td>)</td>
          <td>&#160;&#160;&#160;{<a class="el" href="group__internals.html#ga9ac5ac4cb62a9baa48d2004876852112">_THREADSQUEUE_DATA</a>(name.m_queue), NULL, NULL}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Data part of a static mutex initializer. </p>
<p>This macro should be used when statically initializing a mutex that is part of a bigger structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>the name of the mutex variable </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="chmtx_8h_source.html#l00075">75</a> of file <a class="el" href="chmtx_8h_source.html">chmtx.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga0461d963db5d730f1829eb783f6fdf94"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MUTEX_DECL</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="struct_mutex.html">Mutex</a> name = <a class="el" href="group__mutexes.html#ga01a9ed719f222e64589413d6eda7396e">_MUTEX_DATA</a>(name)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Static mutex initializer. </p>
<p>Statically initialized mutexes require no explicit initialization using <code><a class="el" href="group__mutexes.html#gac55fe4d05aa6bbeb31594193d2e4d2b6" title="Initializes s Mutex structure. ">chMtxInit()</a></code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>the name of the mutex variable </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="chmtx_8h_source.html#l00084">84</a> of file <a class="el" href="chmtx_8h_source.html">chmtx.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga322ebcfba68cf5b66b9c315638e3ae63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define chMtxQueueNotEmptyS</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">mp</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="group__internals.html#ga8f6bea56a53acc44758fe61c98d68a4e">notempty</a>(&amp;(mp)-&gt;m_queue)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns <code>TRUE</code> if the mutex queue contains at least a waiting thread. </p>
<dl class="section user"><dt>Function Class:</dt><dd>This is an <b>S-Class</b> API, this function can be invoked from within a system lock zone by threads only. </dd></dl>

<p>Definition at line <a class="el" href="chmtx_8h_source.html#l00096">96</a> of file <a class="el" href="chmtx_8h_source.html">chmtx.h</a>.</p>

<p>Referenced by <a class="el" href="group__mutexes.html#gae9ae07165126c9f6c0ce0b17bdb53669">chMtxUnlock()</a>, <a class="el" href="group__mutexes.html#ga853b4ced43d22fb5d82678dd2f0aba75">chMtxUnlockAll()</a>, and <a class="el" href="group__mutexes.html#ga705fa60fb8aa28a6632f693e83f78c96">chMtxUnlockS()</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ga9b2dfabf6db35faa7fd04ea30834012d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct_mutex.html">Mutex</a>  <a class="el" href="struct_mutex.html">Mutex</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="struct_mutex.html" title="Mutex structure. ">Mutex</a> structure. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
    <li class="footer">
      <a href="http://sourceforge.net/projects/chibios">
        <img src="http://sflogo.sourceforge.net/sflogo.php?group_id=205897&amp;type=11"
             border="0" width="120" height="30"
             alt="Get ChibiOS/RT embedded RTOS at SourceForge.net. Fast,
                  secure and Free Open Source software downloads"/>
      </a>
    </li>
  </ul>
</div>
<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://apps.sourceforge.net/piwik/chibios/" : "http://apps.sourceforge.net/piwik/chibios/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 1;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p><img src="http://apps.sourceforge.net/piwik/chibios/piwik.php?idsite=1" alt="piwik"/></p></noscript></object>
<!-- End Piwik Tag -->
</body>
</html>
